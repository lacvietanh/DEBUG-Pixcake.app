{"version":3,"sources":["webpack:///./src/qt-ipc/constant.ts","webpack:///./src/mixins/tsFileImport.ts","webpack:///./src/views/BatchRetouch/components/ImportProgressDialog.vue","webpack:///src/views/BatchRetouch/components/ImportProgressDialog.vue","webpack:///./src/views/BatchRetouch/components/ImportProgressDialog.vue?200f","webpack:///./src/views/BatchRetouch/components/ImportProgressDialog.vue?9a43","webpack:///./src/views/BatchRetouch/components/ImportProgressDialog.vue?0356","webpack:///./src/views/BatchRetouch/components/deleteProgressDialog.vue?ed79","webpack:///./src/views/BatchRetouch/components/deleteProgressDialog.vue?ccd3","webpack:///src/views/BatchRetouch/components/deleteProgressDialog.vue","webpack:///./src/views/BatchRetouch/components/deleteProgressDialog.vue?9193","webpack:///./src/views/BatchRetouch/components/ImportProgressDialog.vue?8234","webpack:///./src/views/BatchRetouch/components/deleteProgressDialog.vue?6625","webpack:///./src/views/Home/components/renameProjectDialog.vue","webpack:///src/views/Home/components/renameProjectDialog.vue","webpack:///./src/views/Home/components/renameProjectDialog.vue?548d","webpack:///./src/views/Home/components/renameProjectDialog.vue?c0b3","webpack:///./src/composables/points/useHomeItemPointsRepositories.ts","webpack:///./src/views/Home/components/renameProjectDialog.vue?3797"],"names":["FsConstant","PermissionRetCode","OK","NO_Read_Write","NO_Read","NO_Write","Path_Length_Overflow","kImportConfirmDialog","Vue","extend","mixins","toast","pointsMixin","components","ImportProgressDialog","data","dropPaths","stopImageImport","isMakeSureImport","showImportProgress","importProgress","needDeleteImportProject","dbThumbAbortImportFinished","importIdMaps","Map","importIds","deleteRequestMap","isAppend","curProjectId","onHandlerProgress","onHandlerFinished","myImportName","bIsCancelImport","computed","mapGetters","methods","mapActions","mapMutations","resetHandleCallback","this","onManualImportClick","filePaths","checkAndImportImages","thumbnailCount","importImageRpc","handleAfterMenuManualImport","tsNotify","message","progress","status","ImportProgressStatus","Start","getDropPaths","window","$dragFiles","cancel","console","log","setCancelImportState","Date","CancelImport","_SetCancelImport","filePath","length","result","isDir","ret","overflow","i","fPath","WIN_MAX_PATH","isFile","fs","statSync","accessSync","constants","R_OK","hasRead","hasWrite","W_OK","app","isWin","isLargeThanWin10Version","project","tsFilePathUtils","getProjectRootPathByProject","FileUtils","deleteFolder","e","error","supportedExtendNames","ImageExtendNames","checkCanImport","type","toastNoReadWritePermission","fileDes","permissions","statImportDetail","imgFiles","totalNum","jpgNum","rawNum","item","imgFormat","PointCakeImport","callBack","isOnline","$net","activeProject","innerCheckAndImportImages","importImagesOnHome","removeProject","projectId","_RemoveProject","selectProjects","delete","addConfirmDialogListener","isAdd","dialogIpc","addListener","FConfirmDialogKey","param","tsConfirm","then","async","replyDialogConfirm","catch","removeListener","addImportImageListener","SignalCloseProgressDialogKey","SignalImportProgressKey","over","total","SignalImportFinishedKey","addCounts","SignalUpdateProjectKey","albumbPaths","importTimes","thumbnailNumber","ACT_AsyncUpdateProject","id","path","thumbnailPaths","onUpdateProjectResult","SignalRemoveStoreProjectKey","nProjectId","SignalRootNameKey","rootName","mounted","beforeDestroy","reset","render","_vm","_c","_self","_setupProxy","attrs","visible","on","$event","staticClass","_v","_s","percentage","showCancelBtn","canShowCancelBtn","onCancelClick","_e","staticRenderFns","process","name","props","value","default","importFilePaths","importName","setup","PointHomeItem","loading","loadingTimer","uploadPercent","isCancel","hasImportDbStatus","filters","strPrefix","strMsg","formatMessage","begin","watch","handler","immediate","clearTimeout","delay","strHome","foundKey","foundItem","groupMap","firstDirPath","isFound","retName","calcTextPixLen","ele","document","autoAddPercentage","component","isDeleteProject","extends","DeleteProgressStatus","onClose","title","ref","maxInputLen","nativeOn","indexOf","_k","keyCode","key","onSubmit","apply","arguments","stopPropagation","model","callback","$$v","expression","text","maxLength","shortcutHelper","useHomeItemPointsRepositories","sendPoint","useBaseRepositories","operate","PointEvent","CakeWorkBench","cake_operate","PointClickProject","itemCount","cake_number"],"mappings":"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AGA,YACA,gBACA,kBACA,sBACA,OACA,iBACA,oBACAC,IACA,MAGA,MACA,eACA,IACAC,MAEAA,UACAC,WAGA,iBACA,GACA,4CACAA,YAIA,UAGA,OACA,SACA,WACA,WACA1B,wBACA,kBACA,iBACA,OACA,gBACA,oBACA,WACA,QACA,4BACA,aACA,SACA,MAEA2B,KAEA,SACA,iBACA,qBACAC,KACA,MAGA5B,WAGA,MACA,YAEA,0BAIA,OAHA,kBACA6B,KAEA,GAEAC,kBACA,QAEA,iCAaA,OAVAC,cAEAA,wBACAA,4BAGAC,mCAEA1I,gBACA0I,wCACA,GAEAC,oBAEA,GADAnJ,iCACA,oEAIA,OAHAuI,gCACA,4BACAvI,wCAGA,mDACA,iCACA,uEAIA,OAHAuI,gCACA,4BACAvI,wCAGA,wBACA,sBACA,2BAEA,MAEA8G,gBACA,mCACA,mCCnW4X,I,kCCSxXsC,EAAY,eACd,EACArD,EACAiB,GACA,EACA,KACA,WACA,MAIa,OAAAoC,E,6CCpBf,W,oCCAA,W,kDCAIrD,EAAQiB,E,gDCOG,GACfE,8BACAC,OACAkC,iBACAhH,aACA+E,UAEAR,eACAvE,aACAgF,aAGAiC,eACA7K,aACA,+BACAc,UACA,SACA,0DACA,kCACA,2BACA,2BACA,6BACA,oCAEA,2BAGAoH,aACA,SACA,iBACA,wBACA,yBACA,+BACA,2BAEA,sCACA,4BACA,kCACA,WAAAhC,QAAAC,GAAA,UACA,MACA,yBAEA,2BAIAwD,OACAhB,OACAiB,WACA,gBAEAC,cAEAjC,WACA,uBAEA5G,UACA,SACA8J,kBACAA,oBACAA,2BAEA,yBACA,0BAEAhB,gCACA,eACAC,wDACA,qBAMA7J,YACA,mBACAwK,oBACA,mDACA,iCACA,wBACA,sBACA,2BAEA,QC1F4X,I,kCFSxXC,EAAY,eACd,EACArD,EACAiB,GACA,EACA,KACA,WACA,MAIa,OAAAoC,E,6CGpBf,W,2DCAA,W,2DCAA,IAAIrD,EAAS,WAAkB,IAAIC,EAAIjH,KAAKkH,EAAGD,EAAIE,MAAMD,GAAG,OAAOA,EAAG,YAAY,CAACG,MAAM,CAAC,IAAM,OAAO,MAAQ,QAAQ,eAAe,sCAAsC,QAAUJ,EAAIK,QAAQ,wBAAuB,EAAM,yBAAwB,EAAM,cAAa,EAAK,eAAeL,EAAIwD,SAASlD,GAAG,CAAC,iBAAiB,SAASC,GAAQP,EAAIK,QAAQE,KAAU,CAACN,EAAG,MAAM,CAACO,YAAY,SAAS,CAACR,EAAIS,GAAG,IAAIT,EAAIU,GAAGV,EAAIyD,OAAO,OAAOxD,EAAG,MAAM,CAACO,YAAY,cAAc,CAACP,EAAG,WAAW,CAACyD,IAAI,cAActD,MAAM,CAAC,UAAYJ,EAAI2D,aAAaC,SAAS,CAAC,QAAU,CAAC,SAASrD,GAAQ,OAAIA,EAAOlE,KAAKwH,QAAQ,QAAQ7D,EAAI8D,GAAGvD,EAAOwD,QAAQ,QAAQ,GAAGxD,EAAOyD,IAAI,SAAgB,KAAYhE,EAAIiE,SAASC,MAAM,KAAMC,YAAY,SAAS5D,GAAQ,IAAIA,EAAOlE,KAAKwH,QAAQ,QAAQ7D,EAAI8D,GAAGvD,EAAOwD,QAAQ,QAAQ,GAAGxD,EAAOyD,IAAI,CAAC,IAAI,aAAa,OAAO,KAAKzD,EAAO6D,qBAAsBC,MAAM,CAACjD,MAAOpB,EAAIkB,KAAMoD,SAAS,SAAUC,GAAMvE,EAAIkB,KAAKqD,GAAKC,WAAW,WAAW,GAAGvE,EAAG,MAAM,CAACO,YAAY,UAAU,CAACP,EAAG,YAAY,CAACO,YAAY,eAAeJ,MAAM,CAAC,KAAO,WAAWE,GAAG,CAAC,MAAQN,EAAIwD,UAAU,CAACxD,EAAIS,GAAG,UAAUR,EAAG,YAAY,CAACG,MAAM,CAAC,KAAO,WAAWE,GAAG,CAAC,MAAQN,EAAIiE,WAAW,CAACjE,EAAIS,GAAG,UAAU,MAE5pCO,EAAkB,G,gDCgDP,GACfE,qBACAhK,gBACAG,YACA,oBAEA8J,OACAC,OACA/E,aACA+E,UAEAqD,MACApI,YACA+E,UAEAsD,WACArI,YACA+E,UAGA7J,OAEA,OACA8I,mBACAoD,YACAvC,eACAyC,iDAGAlL,aACA,oBAEA2J,OACAhB,OACAiB,WACA,eACA,6BACA,EACAsC,uBAEAA,qBAEA,IAEA,sBAGArC,cAEAjC,WACA,sBAEA,GACA,oBACA,kCAKAa,QACA,kCAGAvI,YACA,mBACA6K,UACA,gBACA,4BAGAS,WACA,oCAGArE,UACA,sDC7H2X,I,wBCQvXwD,EAAY,eACd,EACArD,EACAiB,GACA,EACA,KACA,WACA,MAIa,OAAAoC,E,kECnBf,8DAQc,SAAUwB,IACpB,MAAM,UAAEC,GAAcC,iBAEtB,SAASrD,EAAcsD,GACnBF,EAAUG,OAAWC,cAAe,CAAEC,aAAcH,IAGxD,SAASI,EAAkBC,GACvBP,EAAUG,OAAWC,cAAe,CAAEC,aAAc,gBAAiBG,YAAaD,IAGtF,MAAO,CACH3D,gBACA0D,uB,kCCrBR,W","file":"js/chunk-c91d35a6.09d1815f.js","sourcesContent":["export enum FsConstant {\n    R_OK = 1 << 1,\n    W_OK = 1 << 2\n}\n","import fs from '@/qt-ipc/fs'\nimport Vue from 'vue'\nimport path from '@/qt-ipc/path'\n// @ts-ignore\nimport md5 from 'js-md5'\nimport ipcRenderer from '@/qt-ipc/Ipc-renderer'\n\n// @ts-ignore\nimport toast from '@/mixins/toast'\nimport { ImportProgressStatus, MaxImportDir } from '@/constants'\nimport { ImageExtendNames, ImageType } from '@/universal/types/constants'\n\nimport { mapActions, mapGetters, mapMutations } from 'vuex'\n\n// @ts-ignore\nimport { getFileExtenstionName, sortBy } from '@/utils/utils'\n// @ts-ignore\nimport tsFilePathUtils from '@/utils/tsFilePathUtils'\n// @ts-ignore\nimport FileUtils from '@/utils/FileUtils'\nimport DBIpcRender from '@/irender/DBIpcRender'\nimport { PALETTE_PRESETS_CFG_TABLE, THUMBNAIL_TABLE } from '@/universal/types/config'\nimport { FsConstant as constants } from '@/qt-ipc/constant'\nimport ImportProgressDialog from '@/views/BatchRetouch/components/ImportProgressDialog.vue'\n\n// import {TSQrc} from '#/utils/tsqrc/tsqrc'\nimport { Optional } from '@/types/index'\nimport IpcRendererAsync from '@/qt-ipc/Ipc-renderer'\nimport Project from '@/model/ProjectModel'\nimport pointsMixin from '@/mixins/pointsMixin'\n// @ts-ignore\nimport { batchDeleteProject } from '@/api/projectApi'\n// @ts-ignore\nimport { deleteThumbnailIds } from '@/api/thumbnailApi'\n// @ts-ignore\nimport { delay } from '@/universal/utils/common'\n// @ts-ignore\nimport { find as findOneProject } from '@/universal/datastore/projectDao'\nimport tsqrcInstance from '@/qt-ipc/pixcookengine'\nimport { EncryptType } from '@/qt-ipc/constants/common'\nimport importImageRpc, {\n    SignalCloseProgressDialogKey,\n    SignalImportFinishedKey,\n    SignalImportProgressKey,\n    SignalRemoveStoreProjectKey, SignalRootNameKey,\n    SignalUpdateProjectKey\n} from '@/qt-ipc/business/import-image'\n\nimport { dialogIpc, FConfirmDialogKey } from '@/qt-ipc/dialog/DialogIpcImpl'\nimport {app} from \"@/qt-ipc/app\";\nimport {WIN_MAX_PATH} from \"@/constants/constants\";\n\n// 1: 是有权限,0: 没有读写权限,-1:没有写权限 ,-2:没有读权限\nexport const PermissionRetCode = {\n    OK: 1, //具有读写权限\n    NO_Read_Write: 0,\n    NO_Read: -2,\n    NO_Write: -1,\n    Path_Length_Overflow:-3\n}\n\nconst kImportConfirmDialog = 'importConfirmDialog'\n\nexport default Vue.extend({\n    mixins: [toast, pointsMixin],\n    components: {\n        ImportProgressDialog\n    },\n    data() {\n        return {\n            dropPaths: [],\n            stopImageImport: false, // 停止图片导入\n            isMakeSureImport: false,// 点击继续导入按钮\n            showImportProgress: false,\n            importProgress: {},\n            // 非二次导入的其非点击按钮创建的，需要在出错时，删除\n            needDeleteImportProject: false,\n            dbThumbAbortImportFinished: false,\n            importIdMaps: new Map(),\n            importIds: [], //导入的id列表\n            // 后端删除接口的请求映射，用于控制并发删除云端数据，已经在删除了，就忽略\n            deleteRequestMap: new Map(),\n            isAppend: false,\n            curProjectId: null, //缓存当前被删除的工程id,用于清理云端的缩略图id\n            onHandlerProgress: null,//((progress: number, over: number, total: number)=> void),\n            onHandlerFinished: null,//((addCounts: number) => void)\n            myImportName:\"\",\n            // 仅在工作台导入的vue层使用,导入创建工程时使用\n            bIsCancelImport:false\n        }\n    },\n\n    computed: {\n        ...mapGetters([\n            'userId'\n        ]),\n\n        ...mapGetters('project', [\n            'activeProject'\n        ]),\n\n        ...mapGetters('thumbnail', [\n            'getThumbnails',\n            'cancelImport'\n        ])\n    },\n\n    methods: {\n        ...mapActions('thumbnail', [\n            'ACT_InsertThumbnail'\n        ]),\n        ...mapActions('project', [\n            'ACT_AsyncUpdateProject',\n            'ACT_DeleteResInProject',\n            'ACT_DeleteProject',\n            'ACT_DeleteResInProjectByThumbIds'\n        ]),\n        ...mapMutations('thumbnail', ['_SetThumbnails', '_AppendThumbnails']),\n        ...mapMutations('project', ['_RemoveProject']),\n        resetHandleCallback(){\n            this.onHandlerFinished = null\n            this.onHandlerProgress = null\n        },\n        onManualImportClick(filePaths:any){\n            this.checkAndImportImages(filePaths, true, (thumbnailCount:number) => {\n                importImageRpc.handleAfterMenuManualImport()\n                this.resetHandleCallback()\n                this.tsNotify({\n                    message: `已导入${thumbnailCount}张图片`\n                })\n            }, (progress:any) => {\n                if (progress.status === ImportProgressStatus.Start) {\n                    this.showImportProgress = true\n                }\n                this.importProgress = progress\n            })\n        },\n        getDropPaths() {\n            let dropPaths = window.$dragFiles\n            return dropPaths\n        },\n        // 点击取消导入的处理\n        async _SetCancelImport(cancel: boolean) {\n            console.log(`_SetCancelImport:`, cancel)\n            await importImageRpc.setCancelImportState(cancel)\n            this.bIsCancelImport = cancel\n        },\n        async handleCancelImport() {\n            //@ts-ignore\n            if (!this.importProgress.status){\n                this.showImportProgress = false\n            }\n            console.log(`handleCancelImport()`, new Date())\n            // @ts-ignore\n            // this.status = ImportProgressStatus.CancelImport\n            this.importProgress.status = ImportProgressStatus.CancelImport\n            // @ts-ignore\n            await this._SetCancelImport(true)\n        },\n        // 1: 是有权限,0: 没有读写权限,-1:没有写权限 ,-2:没有读权限\n        async hasReadWritePermission(filePath: Array<string>): Promise<{ result: number, isDir: boolean }> {\n            if (!filePath || filePath.length === 0) {\n                return { result: PermissionRetCode.NO_Read_Write, isDir: true }\n            }\n            let ret = PermissionRetCode.OK\n            let isDir = true\n            let overflow = false\n            for (let i = 0; i < filePath.length; i++) {\n                let result = true\n                let fPath = filePath[i]\n                overflow = fPath.length > WIN_MAX_PATH\n                // 是文件的则跳过去\n                const isFile = (await fs.statSync(fPath)).isFile()\n                // 要有读的权限\n                if (isFile) {\n                    result = await fs.accessSync(fPath, constants.R_OK)\n                    if (result) {\n                        continue\n                    } else {\n                        ret = PermissionRetCode.NO_Read\n                        isDir = false\n                        break\n                    }\n                } else {\n                    isDir = true\n                    let hasRead = true\n                    let hasWrite = true\n                    result = await fs.accessSync(fPath, constants.R_OK)\n                    if (!result) {\n                        hasRead = false\n                        ret = PermissionRetCode.NO_Read\n                    }\n                    result = await fs.accessSync(fPath, constants.W_OK)\n                    if (!result) {\n                        hasWrite = false\n                        ret = hasRead ? PermissionRetCode.NO_Write : PermissionRetCode.NO_Read_Write\n                    }\n                    if (!hasRead || !hasWrite) {\n                        break\n                    }\n                }\n            }\n            if (ret != PermissionRetCode.OK && app.isWin && !app.isLargeThanWin10Version && overflow){\n                ret = PermissionRetCode.Path_Length_Overflow\n            }\n            return { result: ret, isDir: isDir }\n        },\n\n        // 删除项目缓存\n        async deleteProjectCache(project: any) {\n            let filePath = await tsFilePathUtils.getProjectRootPathByProject(project)\n            try {\n                await FileUtils.deleteFolder(filePath)\n            } catch (e) {\n                console.error(e)\n            }\n        },\n\n        supportedExtendNames() {\n            return ImageExtendNames\n        },\n        checkCanImport(): boolean {\n            // @ts-ignore\n            if (this.showImportProgress) {\n                // @ts-ignore\n                this.tsNotify({\n                    type: 'error',\n                    message: '正在导入中，稍后再尝试'\n                })\n                return false\n            }\n            return true\n        },\n\n\n        toastNoReadWritePermission({ result, isDir }: { result: number, isDir: boolean }) {\n            const fileDes = isDir ? '文件夹' : '文件'\n            const permissions = {\n                [PermissionRetCode.NO_Read]: '读',\n                [PermissionRetCode.NO_Write]: '写',\n                [PermissionRetCode.NO_Read_Write]: '读写'\n            }\n            let message = `该${ fileDes }没有${ permissions[result] }权限`\n            if (result == PermissionRetCode.Path_Length_Overflow){\n                message = `该${ fileDes }路径太长了，不能支持`\n            }\n            // @ts-ignore\n            this.tsNotify({\n                type: 'error',\n                message: message\n            })\n        },\n\n        /*\n            统计导入图片的数量\n         */\n        statImportDetail(imgFiles: Array<{\n            imgPath: string,\n            imgFormat: number,\n            importParentPath: string\n        }>) {\n            let totalNum = imgFiles.length\n            let jpgNum = 0\n            let rawNum = 0\n            for (const item of imgFiles) {\n                if (item.imgFormat == 3) {\n                    rawNum++\n                } else {\n                    jpgNum++\n                }\n            }\n\n            // @ts-ignore\n            this.PointCakeImport(`${ totalNum }_j${ jpgNum }_r${ rawNum }`)\n        },\n\n        /**\n         * 检测导入\n         * @param filePaths\n         * @param isAppend 是否是追加模式的导入\n         * @param callBack\n         * @param progress\n         */\n        async checkAndImportImages(filePaths: any[], isAppend: boolean, callBack: any, progress?: any) {\n            // @ts-ignore\n            if (this.showImportProgress) {\n                // @ts-ignore\n                this.tsNotify({\n                    type: 'error',\n                    message: '正在导入中，稍后再尝试'\n                })\n                return\n            }\n            let isOnline = await window.$net.isOnline()\n            if (!isOnline) {\n                // @ts-ignore\n                this.tsNotify({\n                    type: 'error',\n                    message: '网络异常，请检查网络后再试'\n                })\n                return\n            }\n            this.onHandlerProgress = progress\n            this.onHandlerFinished = callBack\n            this.dropPaths = filePaths as any\n            this.isAppend = isAppend\n            const project = this.activeProject\n            await this.innerCheckAndImportImages(project, filePaths, isAppend, this.needDeleteImportProject, callBack)\n        },\n\n        /**\n         * HOME首页的调用此项\n         * @param filePaths\n         * @param isAppend 是否是追加模式的导入\n         * @param callBack\n         * @param progress\n         */\n        async importImagesOnHome(filePaths: any[], isAppend: boolean, callBack: any, progress?: any) {\n            // @ts-ignore\n            // if (this.showImportProgress) {\n            //     // @ts-ignore\n            //     this.tsNotify({\n            //         type: 'error',\n            //         message: '正在导入中，稍后再尝试'\n            //     })\n            //     return\n            // }\n            let isOnline = await window.$net.isOnline()\n            if (!isOnline) {\n                // @ts-ignore\n                this.tsNotify({\n                    type: 'error',\n                    message: '网络异常，请检查网络后再试'\n                })\n                return\n            }\n            this.onHandlerProgress = progress\n            this.onHandlerFinished = callBack\n            this.dropPaths = filePaths as any\n            this.isAppend = isAppend\n            const project = this.activeProject\n\n            this.showImportProgress = true;\n            await importImageRpc.importImagesOnHome(isAppend, project, filePaths, this.needDeleteImportProject)\n        },\n\n        /*\n            内部的导入方法\n         */\n        async innerCheckAndImportImages(project: any, dropPaths: any, isAppend: boolean, needDeleteImportProject: boolean, callBack: any) {\n            this.showImportProgress = true;\n            await importImageRpc.checkAndImportImages(this.activeProject, dropPaths, isAppend, needDeleteImportProject)\n        },\n\n        removeProject(projectId: number) {\n            this._RemoveProject(projectId)\n            //@ts-ignore\n            this.selectProjects.delete(projectId)\n        },\n        addConfirmDialogListener(isAdd: boolean) {\n            if (isAdd) {\n                dialogIpc.addListener(FConfirmDialogKey(kImportConfirmDialog), (param: any) => {\n                    this.tsConfirm(param).then(async _ => {\n                        await dialogIpc.replyDialogConfirm(true)\n                    })\n                        .catch(async e => {\n                            await dialogIpc.replyDialogConfirm(false)\n                        })\n                })\n            } else {\n                dialogIpc.removeListener(FConfirmDialogKey(kImportConfirmDialog))\n            }\n        },\n        addImportImageListener() {\n            importImageRpc.addListener(SignalCloseProgressDialogKey, () => {\n                this.showImportProgress = false\n            })\n            importImageRpc.addListener(SignalImportProgressKey, (progress: number, over: number, total: number) => {\n                if (this.onHandlerProgress) {\n                    //@ts-ignore\n                    this.onHandlerProgress({\n                        status: `${ progress }`,\n                        over: `${ over }`,\n                        total: `${ total }`\n                    })\n                }\n            })\n            importImageRpc.addListener(SignalImportFinishedKey, (addCounts: number) => {\n                this.showImportProgress = false\n                if (this.onHandlerFinished) {\n                    //@ts-ignore\n                    this.onHandlerFinished(addCounts)\n                }\n            })\n            importImageRpc.addListener(SignalUpdateProjectKey, (albumbPaths: any, importTimes: number, thumbnailNumber: number,isAppend:boolean) => {\n                this.ACT_AsyncUpdateProject({\n                    // 如果是首次导入(非追加模式),则是要更新filePaths到工程路径\n                    // @ts-ignore\n                    id: this.activeProject.id,\n                    path: isAppend ? this.activeProject.path : this.dropPaths,\n                    thumbnailPaths: albumbPaths,\n                    importTimes: importTimes,\n                    // @ts-ignore\n                    thumbnailNumber: thumbnailNumber\n                }).then(async (resolve) => {\n                    // debugger\n                    await this._SetCancelImport(false)\n                    // 判断数据库的是否更新成功\n                    await importImageRpc.onUpdateProjectResult(true)\n                }).catch(async e => {\n                    // debugger\n                    console.error(e)\n                    await this._SetCancelImport(false)\n                    await importImageRpc.onUpdateProjectResult(false)\n                })\n            })\n            importImageRpc.addListener(SignalRemoveStoreProjectKey, (nProjectId: number) => {\n                this.removeProject(nProjectId)\n            })\n            importImageRpc.addListener(SignalRootNameKey, (rootName: string) => {\n                this.myImportName = rootName\n            })\n        }\n    },\n    mounted() {\n        this.addImportImageListener()\n        this.addConfirmDialogListener(true)\n    },\n    beforeDestroy() {\n        importImageRpc.reset()\n        this.addConfirmDialogListener(false)\n    }\n})\n","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('el-dialog',{attrs:{\"top\":\"40vh\",\"width\":\"370px\",\"align\":\"center\",\"title\":\"\",\"custom-class\":\"common-dialog import-progress-dialog\",\"visible\":_vm.visible,\"close-on-click-modal\":false,\"close-on-press-escape\":false,\"show-close\":false},on:{\"update:visible\":function($event){_vm.visible=$event}}},[_c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"info\"},[_vm._v(_vm._s(_vm.message))]),_c('div',{staticClass:\"claProgressItem\"},[_c('el-progress',{attrs:{\"show-text\":false,\"text-inside\":\"\",\"stroke-width\":5,\"percentage\":_vm.percentage > 100?100:_vm.percentage}}),(_vm.showCancelBtn && _vm.canShowCancelBtn)?_c('el-button',{staticClass:\"claCloseBtn\",attrs:{\"icon\":\"el-icon-close\"},on:{\"click\":_vm.onCancelClick}}):_vm._e()],1)])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <el-dialog\n        top=\"40vh\"\n        width=\"370px\"\n        align=\"center\"\n        title=\"\"\n        custom-class=\"common-dialog import-progress-dialog\"\n        :visible.sync=\"visible\"\n        :close-on-click-modal=\"false\"\n        :close-on-press-escape=\"false\"\n        :show-close=\"false\"\n    >\n        <div class=\"container\">\n            <div class=\"info\">{{ message }}</div>\n            <div class=\"claProgressItem\">\n                <el-progress\n                    :show-text=\"false\"\n                    text-inside\n                    :stroke-width=\"5\"\n                    :percentage=\"percentage > 100?100:percentage\"\n                />\n\n                <el-button\n                    v-if=\"showCancelBtn && canShowCancelBtn\"\n                    icon=\"el-icon-close\"\n                    class=\"claCloseBtn\"\n                    @click=\"onCancelClick\">\n                </el-button>\n            </div>\n        </div>\n    </el-dialog>\n</template>\n\n<script>\n\nimport { defineComponent } from 'vue'\nimport { mapGetters, mapMutations } from 'vuex'\nimport toast from '@/mixins/toast'\nimport { ImportProgressStatus } from '@/constants'\n\nimport { Dialog, Progress } from 'element-ui'\nimport { delay } from '@/universal/utils/common'\nimport NodeApi from '@/qt-ipc/node-api'\nimport TsDialog from '@/components/TsDialog/ts-dialog'\nimport useHomeItemPointsRepositories from '@/composables/points/useHomeItemPointsRepositories'\n\nconst path = NodeApi.path\nconst process = require('process')\n\nexport default defineComponent({\n    name: 'import-progress-dialog',\n    mixins: [toast],\n    components: {\n        'el-dialog': TsDialog,\n        'el-progress': Progress,\n\n    },\n    props: {\n        value: {\n            type: Boolean,\n            default: false\n        },\n        status: {\n            type: String,\n            default: ImportProgressStatus.Start\n        },\n        data: {\n            type: Object,\n            default: () => {\n            }\n        },\n        // 导入的文件路径列表\n        importFilePaths: {\n            type: Array,\n            default: () => {\n                return []\n            }\n        },\n        showCancelBtn: {\n            type: Boolean,\n            default: true\n        },\n        importName:{\n            type: String,\n            default: \"\"\n        }\n    },\n    setup() {\n        const { PointHomeItem } = useHomeItemPointsRepositories()\n\n        return {\n            PointHomeItem\n        }\n    },\n    data() {\n        return {\n            loading: false,\n            visible: this.value,\n            loadingTimer: null,\n            uploadPercent: 0,\n            isCancel: false,\n            canShowCancelBtn: true,\n            hasImportDbStatus: false\n        }\n    },\n    filters: {},\n    computed: {\n        ...mapGetters('finishing', []),\n        // 计算文本的像素宽度\n        ...mapGetters('thumbnail', [\n            'cancelImport'\n        ]),\n        message() {\n            let name = this.importName\n            const maxTextPixLen = 312\n            const strTemplateMsg = '正在导入${n}下选择的图片'\n            const strFixMsg = strTemplateMsg.replace('${n}', '')\n            const innerMaxTextPixLen = maxTextPixLen - this.calcTextPixLen(strFixMsg)\n            const namePixLen = this.calcTextPixLen(name)\n\n            if (name && namePixLen > innerMaxTextPixLen) {\n                const nameLen = name.length\n                const lastLen = 10\n                const strLastTen = name.substr(name.length - lastLen, lastLen)\n                const lastTenPixLen = this.calcTextPixLen(strLastTen)\n                const aPixLen = namePixLen / nameLen\n                let preLen = (innerMaxTextPixLen - aPixLen * 2 - lastTenPixLen)\n                let strPrefix = ''\n                for (let i = 0; i < nameLen; i++) {\n                    strPrefix += name[i]\n                    const nextPixLen = this.calcTextPixLen(strPrefix)\n                    if (nextPixLen > preLen) {\n                        break\n                    }\n                }\n                name = `${strPrefix}...${strLastTen}`\n            }\n            let strMsg = `正在导入选择的图片`\n            if (name) {\n                strMsg = strTemplateMsg.replace('${n}', name)\n            }\n            if (this.status == ImportProgressStatus.ImportingToDB || this.hasImportDbStatus) {\n                strMsg = `正在载入数据库，请稍后…`\n            }\n\n            return strMsg\n        },\n        formatMessage(strInput) {\n            return strInput\n        },\n        percentage() {\n            const actions = {\n                [ImportProgressStatus.Start]: 2,\n                [ImportProgressStatus.ImportOver]: 100,\n                [ImportProgressStatus.CancelImport]: 19,\n                [ImportProgressStatus.ImportEmpty]: 39,\n                [ImportProgressStatus.RequestZeroError]: 31\n            }\n\n            if (this.status === ImportProgressStatus.Start || this.status === ImportProgressStatus.Importing) {\n                const { over, total } = this.data\n                if (over === undefined || total === undefined) {\n                    return 0\n                }\n                const per = over / total * 100\n                let progress = parseInt(per)\n\n                console.log('per : ', progress, ' status : ', this.status)\n                return progress\n            }\n\n            if (this.status === ImportProgressStatus.Start) {\n                let begin = actions[ImportProgressStatus.Start]\n                const { over, total } = this.data\n                const per = over / total\n                begin += parseInt(40 * per)\n                return this.uploadPercent + begin\n            } else if (this.status === ImportProgressStatus.RequestZero) {\n                return this.uploadPercent + 2\n            } else if (this.status === ImportProgressStatus.Importing) {\n                const { over, total } = this.data\n                const per = over / total\n                return 40 + parseInt(60 * per)\n            } else {\n                return actions[this.status] || 0\n            }\n        }\n    },\n    watch: {\n        value: {\n            handler(val) {\n                this.visible = val\n            },\n            immediate: true\n        },\n        visible(val) {\n            if (!val) {\n                this.hasImportDbStatus = false\n            }\n            this.$emit('input', val)\n        },\n        status(val) {\n            if (val == ImportProgressStatus.ImportingToDB) {\n                this.canShowCancelBtn = false\n                this.hasImportDbStatus = true\n            }\n            const closes = [\n                ImportProgressStatus.ImportOver,\n                ImportProgressStatus.CancelImport,\n                ImportProgressStatus.ImportEmpty,\n                ImportProgressStatus.ImportRepet,\n                ImportProgressStatus.RequestZeroError\n            ]\n            if (val === ImportProgressStatus.RequestZero) {\n                this.autoAddPercentage()\n            } else {\n                clearTimeout(this.loadingTimer)\n                if (closes.includes(val)) {\n                    delay(val === ImportProgressStatus.ImportOver ? 300 : 1000).then(() => {\n                        this.visible = false\n                    })\n                }\n            }\n        }\n    },\n    mounted() {\n    },\n    methods: {\n        ...mapMutations([]),\n        async getInputRootName() {\n            console.log(`getInputRootName`, process)\n            const strHome = process.env.HOME || process.env.USERPROFILE || process.env.HOMEPATH\n            const filePaths = this.importFilePaths\n            const rootSysDisk = await path.parse(strHome).root.toUpperCase()\n\n            const winSysDefDir = [\n                strHome,\n                await path.join(rootSysDisk, '/Public')\n            ]\n            const macSysDefDir = [\n                '/Applications',\n                '/Users/Shared',\n                strHome\n            ]\n\n            const groupRootPathByPath = async (inputFilePaths) => {\n                const groupMap = new Map()\n                for (const inputFilePath of inputFilePaths) {\n                    let curSysDefDir = this.$isWin ? winSysDefDir : macSysDefDir\n                    let foundKey = null\n                    for (const it of curSysDefDir) {\n                        if (inputFilePath.startsWith(it)) {\n                            foundKey = it\n                            break\n                        }\n                    }\n                    if (foundKey) {\n                        let foundItem = groupMap.get(foundKey)\n                        if (!foundItem) {\n                            foundItem = []\n                        }\n                        foundItem.push(inputFilePath)\n                        groupMap.set(foundKey, foundItem)\n                    }\n\n                    if (this.$isWin) { // 如果是win,没找到，则可能是其他盘符\n                        if (!foundKey) {\n                            const rootDisk = await path.parse(inputFilePath).root.toUpperCase()\n                            groupMap.set(rootDisk, inputFilePath)\n                        }\n                    }\n                }\n                return groupMap\n            }\n\n            const filterGroup = groupRootPathByPath(filePaths)\n            const groupSize = filterGroup.size\n            let name = null\n            if (groupSize === 1) { // 找不到特定的约定的目录，则归为others\n                name = filterGroup.keys().next().value\n                if (name.startsWith(strHome)) { // 是家目录下面的，要区分具体的名称\n                    const dstList = filterGroup.get(name)\n                    const firstItem = dstList[0]\n                    const sep = await path.sep()\n                    const fHome = await path.join(strHome, sep)\n                    const beginIndex = fHome.length\n                    let firstDirPath = fHome\n                    for (let i = beginIndex; i < firstItem.length; i++) {\n                        const a = firstItem[i]\n                        if (a === sep) {\n                            break\n                        }\n                        firstDirPath += a\n                    }\n                    let isFound = true\n                    for (const nextItem of dstList) {\n                        if (!nextItem.startsWith(firstDirPath)) {\n                            isFound = false\n                            break\n                        }\n                    }\n                    name = isFound ? firstDirPath : null\n                }\n            }\n            if (!name) {\n                return null\n            }\n            let retName = await path.basename(name)\n            if (!retName || retName.length === 0) {\n                retName = name\n            }\n            return retName\n        },\n        calcTextPixLen(text) {\n            let result = 0\n\n            let ele = document.createElement('span')\n            //字符串中带有换行符时，会被自动转换成<br/>标签，若需要考虑这种情况，可以替换成空格，以获取正确的宽度\n            //str = str.replace(/\\\\n/g,' ').replace(/\\\\r/g,' ');\n            ele.innerText = text\n            //不同的大小和不同的字体都会导致渲染出来的字符串宽度变化，可以传入尽可能完备的样式信息\n            ele.style.fontSize = '14px'\n            ele.style.fontWeight = 'normal'\n\n            //由于父节点的样式会影响子节点，这里可按需添加到指定节点上\n            document.documentElement.append(ele)\n\n            result = ele.offsetWidth\n            document.documentElement.removeChild(ele)\n            return result\n        },\n        autoAddPercentage() {\n            console.log('autoAddPercentage')\n            if (this.status === ImportProgressStatus.CancelImport || !this.visible || this.cancelImport) {\n                clearTimeout(this.loadingTimer)\n                this.loadingTimer = null\n                console.log(`kill autoAddPercentage()`)\n                return\n            }\n            if (this.loadingTimer) clearTimeout(this.loadingTimer)\n            this.loadingTimer = setTimeout(_ => {\n                if (this.status === ImportProgressStatus.CancelImport || !this.visible || this.cancelImport) {\n                    clearTimeout(this.loadingTimer)\n                    this.loadingTimer = null\n                    console.log(`kill autoAddPercentage()`)\n                    return\n                }\n                if (this.uploadPercent < 38) {\n                    this.uploadPercent += 1\n                    this.autoAddPercentage()\n                }\n            }, 100)\n        },\n        onCancelClick() {\n            this.PointHomeItem(\"import_close\")\n            this.$emit('onCancelled', null)\n        }\n    }\n})\n</script>\n\n<style lang=\"scss\">\n.import-progress-dialog {\n    .el-dialog__header {\n        display: none;\n    }\n\n    .el-dialog__body {\n        padding: 40px 28px !important;\n    }\n}\n</style>\n\n<style lang=\"scss\" scoped>\n.import-progress-dialog {\n    /deep/ {\n        .el-dialog__header {\n            display: none;\n        }\n\n        .el-dialog__body {\n            padding: 40px 28px;\n        }\n    }\n\n    .container {\n        text-align: left;\n        color: #D9D9D9;\n\n        .info {\n            margin-bottom: 8px;\n        }\n\n        .claProgressItem {\n            display: flex;\n            flex-direction: row;\n            align-items: center;\n\n            .claCloseBtn {\n                background: #4E4E4E;\n                width: 18px;\n                height: 18px;\n                border-radius: 9px;\n                padding: 0px;\n                flex-shrink: 1;\n            }\n\n            /deep/ .el-progress {\n                flex: 1;\n                margin-right: 12px;\n                font-size: 14px;\n            }\n        }\n    }\n}\n\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImportProgressDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImportProgressDialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ImportProgressDialog.vue?vue&type=template&id=193bb274&scoped=true&\"\nimport script from \"./ImportProgressDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./ImportProgressDialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ImportProgressDialog.vue?vue&type=style&index=0&id=193bb274&prod&lang=scss&\"\nimport style1 from \"./ImportProgressDialog.vue?vue&type=style&index=1&id=193bb274&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"193bb274\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImportProgressDialog.vue?vue&type=style&index=1&id=193bb274&prod&lang=scss&scoped=true&\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./deleteProgressDialog.vue?vue&type=style&index=0&id=5e4079d0&prod&lang=scss&\"","var render, staticRenderFns\nimport script from \"./deleteProgressDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./deleteProgressDialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./deleteProgressDialog.vue?vue&type=style&index=0&id=5e4079d0&prod&lang=scss&\"\nimport style1 from \"./deleteProgressDialog.vue?vue&type=style&index=1&id=5e4079d0&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5e4079d0\",\n  null\n  \n)\n\nexport default component.exports","<script>\n\nimport { mapGetters, mapMutations } from 'vuex'\nimport { DeleteProgressStatus } from '@/constants'\nimport ImportProgressDialog from '@/views/BatchRetouch/components/ImportProgressDialog'\nimport { delay } from '@/universal/utils/common'\n\nexport default {\n    name: 'delete-progress-dialog',\n    props: {\n        isDeleteProject: {\n            type: Boolean,\n            value: false\n        },\n        showCancelBtn: {\n            type: Boolean,\n            default: false\n        }\n    },\n    extends: ImportProgressDialog,\n    computed: {\n        ...mapGetters('finishing', []),\n        message() {\n            const actions = {\n                [DeleteProgressStatus.Start]: this.isDeleteProject ? '正在准备删除项目' : '正在准备删除文件',\n                [DeleteProgressStatus.RequestDelete]: '正在请求删除数据',\n                [DeleteProgressStatus.Deleting]: '正在删除数据',\n                [DeleteProgressStatus.DeleteOver]: '删除完成',\n                [DeleteProgressStatus.CancelDelete]: '取消删除',\n                [DeleteProgressStatus.RequestDeleteError]: '删除失败'\n            }\n            return actions[this.status] || ''\n        },\n\n        percentage() {\n            const actions = {\n                [DeleteProgressStatus.Start]: 2,\n                [DeleteProgressStatus.DeleteOver]: 100,\n                [DeleteProgressStatus.CancelDelete]: 19,\n                [DeleteProgressStatus.RequestDeleteError]: 39,\n                [DeleteProgressStatus.RequestDelete]: 31\n            }\n            if (this.status === DeleteProgressStatus.RequestDelete) {\n                return this.uploadPercent + 2\n            } else if (this.status === DeleteProgressStatus.Deleting) {\n                const { over, total } = this.data\n                const per = over / total\n                return 40 + parseInt(60 * per)\n            } else {\n                return actions[this.status] || 0\n            }\n        }\n    },\n    watch: {\n        value: {\n            handler(val) {\n                this.visible = val\n            },\n            immediate: true\n        },\n        visible(val) {\n            this.$emit('input', val)\n        },\n        status(val) {\n            const closes = [\n                DeleteProgressStatus.DeleteOver,\n                DeleteProgressStatus.CancelDelete,\n                DeleteProgressStatus.RequestDeleteError\n            ]\n            if (val === DeleteProgressStatus.RequestDelete) {\n                this.autoAddPercentage()\n            } else {\n                clearTimeout(this.loadingTimer)\n                if (closes.includes(val)) {\n                    delay(val === DeleteProgressStatus.DeleteOver ? 300 : 1000).then(() => {\n                        this.visible = false\n                    })\n                }\n            }\n        }\n    },\n    methods: {\n        ...mapMutations([]),\n        autoAddPercentage() {\n            if (this.loadingTimer) clearTimeout(this.loadingTimer)\n            this.loadingTimer = setTimeout(_ => {\n                if (this.uploadPercent < 38) {\n                    this.uploadPercent += 1\n                    this.autoAddPercentage()\n                }\n            }, 100)\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\">\n.import-progress-dialog {\n    .el-dialog__header {\n        display: none;\n    }\n\n    .el-dialog__body {\n        padding: 40px 28px !important;\n    }\n}\n</style>\n\n<style lang=\"scss\" scoped>\n.import-progress-dialog {\n    /deep/ {\n        .el-dialog__header {\n            display: none;\n        }\n\n        .el-dialog__body {\n            padding: 40px 28px;\n        }\n    }\n\n    .container {\n        text-align: left;\n        color: #D9D9D9;\n\n        .info {\n            margin-bottom: 16px;\n        }\n    }\n}\n\n</style>\n\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./deleteProgressDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./deleteProgressDialog.vue?vue&type=script&lang=js&\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ImportProgressDialog.vue?vue&type=style&index=0&id=193bb274&prod&lang=scss&\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./deleteProgressDialog.vue?vue&type=style&index=1&id=5e4079d0&prod&lang=scss&scoped=true&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-dialog',{attrs:{\"top\":\"30vh\",\"width\":\"400px\",\"custom-class\":\"common-dialog cover-dialog myDialog\",\"visible\":_vm.visible,\"close-on-click-modal\":false,\"close-on-press-escape\":false,\"show-close\":true,\"before-close\":_vm.onClose},on:{\"update:visible\":function($event){_vm.visible=$event}}},[_c('div',{staticClass:\"title\"},[_vm._v(\" \"+_vm._s(_vm.title)+\" \")]),_c('div',{staticClass:\"claContent\"},[_c('el-input',{ref:\"inputRename\",attrs:{\"maxlength\":_vm.maxInputLen},nativeOn:{\"keydown\":[function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\"))return null;return _vm.onSubmit.apply(null, arguments)},function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"space\",32,$event.key,[\" \",\"Spacebar\"]))return null;$event.stopPropagation();}]},model:{value:(_vm.name),callback:function ($$v) {_vm.name=$$v},expression:\"name\"}})],1),_c('div',{staticClass:\"footer\"},[_c('el-button',{staticClass:\"claBotButton\",attrs:{\"type\":\"default\"},on:{\"click\":_vm.onClose}},[_vm._v(\" 取消 \")]),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSubmit}},[_vm._v(\"确定 \")])],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <el-dialog\n        top=\"30vh\"\n        width=\"400px\"\n        custom-class=\"common-dialog cover-dialog myDialog\"\n        :visible.sync=\"visible\"\n        :close-on-click-modal=\"false\"\n        :close-on-press-escape=\"false\"\n        :show-close=\"true\"\n        :before-close=\"onClose\"\n    >\n        <div class=\"title\">\n            {{ title }}\n        </div>\n        <!-- 配置验证规则-->\n        <div class=\"claContent\">\n            <el-input\n                ref=\"inputRename\"\n                :maxlength=\"maxInputLen\"\n                v-model=\"name\"\n                @keydown.native.enter=\"onSubmit\"\n                @keydown.space.native.stop\n            ></el-input>\n        </div>\n\n        <div class=\"footer\">\n            <el-button\n                type=\"default\"\n                class=\"claBotButton\"\n                @click=\"onClose\">\n                取消\n            </el-button>\n            <el-button\n                type=\"primary\"\n                @click=\"onSubmit\"\n            >确定\n            </el-button>\n        </div>\n    </el-dialog>\n</template>\n\n<script>\n// import ipcRenderer from '@/qt-ipc/Ipc-renderer'\nimport { mapActions, mapGetters } from 'vuex'\nimport toast from '@/mixins/toast'\nimport ShortcutHelper from '@/utils/Shortcut/ShortcutHelper'\n// import {log} from \"~/main/utils/log4js\";\nimport TsDialog from '@/components/TsDialog/ts-dialog'\n\n\nexport default {\n    name: 'renameProject',\n    mixins: [toast],\n    components:{\n        'el-dialog':TsDialog\n    },\n    props: {\n        value: {\n            type: Boolean,\n            value: false\n        },\n        text: {\n            type: String,\n            value: ''\n        },\n        maxLength: {\n            type: Number,\n            value: 0\n        }\n    },\n    data() {\n\n        return {\n            visible: this.value,\n            title: `重命名`,\n            name: this.text,\n            maxInputLen: this.maxLength > 0 ? this.maxLength : 30\n        }\n    },\n    computed: {\n        ...mapGetters([])\n    },\n    watch: {\n        value: {\n            handler(val) {\n                this.visible = val\n                const shortcutHelper = ShortcutHelper.getInstance()\n                if (val) {\n                    shortcutHelper.unRegisterShortcut()\n                } else {\n                    shortcutHelper.registerShortcut()\n                }\n                if (val) {\n\n                    this.name = this.text\n                }\n            },\n            immediate: true\n        },\n        visible(val) {\n            this.$emit('input', val)\n\n            if (val) {\n                this.$nextTick(() => {\n                    this.$refs.inputRename.focus()\n                })\n            }\n\n        },\n        name(val) {\n            this.$emit('changed', this.name)\n        }\n    },\n    methods: {\n        ...mapActions([]),\n        onClose() {\n            this.visible = false\n            this.$emit('onClose', null)\n        },\n        // 导入图片 ,做接口请求\n        onSubmit() {\n            this.$emit(`onConfirm`, this.name)\n        }\n    },\n    mounted() {\n        this.maxInputLen = this.maxLength > 0 ? this.maxLength : 30\n    }\n}\n</script>\n\n<style scoped lang=\"scss\">\n/deep/ .el-dialog.common-dialog.myDialog {\n    height: 208px;\n\n    .el-dialog__header {\n        padding: 0px;\n    }\n\n    .el-dialog__body {\n        .title {\n            margin-top: 25px;\n        }\n\n        .claContent {\n\n        }\n\n        .footer {\n            margin-top: 20px;\n\n            .claBotButton {\n                margin-right: 16px;\n            }\n        }\n    }\n}\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./renameProjectDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./renameProjectDialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./renameProjectDialog.vue?vue&type=template&id=474ab757&scoped=true&\"\nimport script from \"./renameProjectDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./renameProjectDialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./renameProjectDialog.vue?vue&type=style&index=0&id=474ab757&prod&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"474ab757\",\n  null\n  \n)\n\nexport default component.exports","import useBaseRepositories from './useBaseRepositories'\nimport { PointEvent } from '@/constants/pointsDef'\n\ninterface IUseUpdatePointsRepositories {\n    PointHomeItem: (operate: string) => void\n    PointClickProject: (itemCount: number) => void\n}\n\nexport default function useHomeItemPointsRepositories(): IUseUpdatePointsRepositories {\n    const { sendPoint } = useBaseRepositories()\n\n    function PointHomeItem(operate: string) {\n        sendPoint(PointEvent.CakeWorkBench, { cake_operate: operate })\n    }\n\n    function PointClickProject(itemCount: number) {\n        sendPoint(PointEvent.CakeWorkBench, { cake_operate: 'click_project', cake_number: itemCount })\n    }\n\n    return {\n        PointHomeItem,\n        PointClickProject\n    }\n}\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./renameProjectDialog.vue?vue&type=style&index=0&id=474ab757&prod&scoped=true&lang=scss&\""],"sourceRoot":""}